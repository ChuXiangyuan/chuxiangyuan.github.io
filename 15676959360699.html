<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  Sign in with Apple 的设计准则和功能实现 - 向远公园 | Step Park
  
  </title>
  
  
  <link href="atom.xml" rel="alternate" title="向远公园 | Step Park" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />
    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
  <script src="asset/highlightjs/highlight.pack.js"></script>
  <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script>hljs.initHighlightingOnLoad();</script>
<script type="text/javascript">
  function before_search(){
    var searchVal = 'site:steppark.net ' + document.getElementById('search_input').value;
    document.getElementById('search_q').value = searchVal;
    return true;
  }
</script>
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>


  <section class="top-bar-section">
  <div class="row">
      <div style="position: relative;width:100%;"><div style="position: absolute; width:100%;">
        <ul id="main-menu" class="left">
        
        <li id=""><a target="_self" href="index.html">Home</a></li>
        
        <li id=""><a target="_self" href="archives.html">Archives</a></li>
        
        <li id=""><a target="_self" href="music.html">Music</a></li>
        
        <li id=""><a target="_self" href="about.html">About</a></li>
        
        </ul>

        <ul class="right" id="search-wrap">
          <li>
<form target="_blank" onsubmit="return before_search();" action="http://google.com/search" method="get">
    <input type="hidden" id="search_q" name="q" value="" />
    <input tabindex="1" type="search" id="search_input"  placeholder="Search"/>
</form>
</li>
          </ul>
      </div></div>
  </div>
  </section>

</nav>

        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; 向远公园 | Step Park</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
        
        <li><a target="_self" href="index.html">Home</a></li>
        
        <li><a target="_self" href="archives.html">Archives</a></li>
        
        <li><a target="_self" href="music.html">Music</a></li>
        
        <li><a target="_self" href="about.html">About</a></li>
        

    <li><label>Categories</label></li>

        
            <li><a href="Design.html">Design</a></li>
        
            <li><a href="Develop.html">Develop</a></li>
        
            <li><a href="Teconology.html">Teconology</a></li>
        
            <li><a href="Tools.html">Tools</a></li>
        
            <li><a href="Life.html">Life</a></li>
        
            <li><a href="Talk.html">Talk</a></li>
        
            <li><a href="Others.html">Others</a></li>
         

      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>


        <section id="main-content" role="main" class="scroll-container">
        
       

 <script type="text/javascript">
  $(function(){
    $('#menu_item_index').addClass('is_active');
  });
</script>
<div class="row">
  <div class="large-8 medium-8 columns">
      <div class="markdown-body article-wrap">
       <div class="article">
          
          <h1>Sign in with Apple 的设计准则和功能实现</h1>
     
        <div class="read-more clearfix">
          <span class="date">2019/8/25</span>

          <span>posted in&nbsp;</span> 
          
              <span class="posted-in"><a href='Design.html'>Design</a></span>
          
              <span class="posted-in"><a href='Develop.html'>Develop</a></span>
           
         
          <span class="comments">
            
              <a href="https://steppark.net/15676959360699.html#disqus_thread">comments</a>
            

            
          </span>

        </div>
      </div><!-- article -->

      <div class="article-content">
      <p>在你的 app 或者网站上展示一个「Sign in with Apple」按钮意味着人们可以只通过他们已经拥有的 Apple ID 进行登录或注册，跳过填写个人信息、确认电子邮箱和选择密码的部分。Sign in with Apple 通过给用户一个一致的、他们可以信任的登录体验提供了一个全新的、更加隐私的方式以简化和加快登录 app 和网站的过程，也方便了用户不需要记住多个账户和密码。在你需要请求用户的名字和电子邮箱的地方，用户可以选择对他们的真实电子邮箱进行保密，而提供一个独一无二的、随机的、可收发邮件的电子邮箱地址。<br/>
Sign in with Apple</p>

<span id="more"></span><!-- more -->

<p><img src="media/15676959360699/hero-lockup-large_2x.png" alt="" class="mw_img_center" style="display: block; clear:both; margin: 0 auto;"/></p>

<p>Sign in with Apple 让人们通过 Face ID 或者 Touch ID 完成授权变得简单，并且内建了两步验证以增加安全层级。Apple 不会通过 Sign in with Apple 的活动在 app 中收集用户的个性化资料和他们的具体活动。<br/>
Sign in with Apple 提供了反欺骗的特性，它可以通过机器学习和其他信息提供给开发者一个新用户是真实人类还是需要进一步观察的标志。</p>

<h2 id="toc_0">目录</h2>

<ul>
<li>
<a href="#toc_0">目录</a>
</li>
<li>
<a href="#toc_1">What&#39;s New</a>
</li>
<li>
<a href="#toc_2">设计帐户注册和登录流程</a>
</li>
<li>
<a href="#toc_3">Sign in with Apple 按钮</a>
<ul>
<li>
<a href="#toc_4">使用系统提供的按钮</a>
<ul>
<li>
<a href="#toc_5">白色</a>
</li>
<li>
<a href="#toc_6">带描边的白色</a>
</li>
<li>
<a href="#toc_7">黑色</a>
</li>
</ul>
</li>
<li>
<a href="#toc_8">按钮尺寸和位置</a>
</li>
<li>
<a href="#toc_9">创建一个自定义的 Sign in with Apple 按钮</a>
<ul>
<li>
<a href="#toc_10">左对齐 logo 样式的按钮</a>
</li>
<li>
<a href="#toc_11">只有 logo 样式的按钮</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#toc_12">实现 Sign in with Apple</a>
<ul>
<li>
<a href="#toc_13">纵览</a>
</li>
<li>
<a href="#toc_14">让 Sign in with Apple 与你的 app 结合</a>
<ul>
<li>
<a href="#toc_15">Button 按钮</a>
</li>
<li>
<a href="#toc_16">Authorization 授权</a>
</li>
<li>
<a href="#toc_17">Verification 鉴权</a>
</li>
<li>
<a href="#toc_18">Handling Changes 处理变动</a>
</li>
</ul>
</li>
<li>
<a href="#toc_19">跨平台</a>
</li>
<li>
<a href="#toc_20">Best Practices</a>
</li>
</ul>
</li>
<li>
<a href="#toc_21">Sign in with Apple 新的审核规范</a>
<ul>
<li>
<a href="#toc_22">App Store 审核规范</a>
</li>
<li>
<a href="#toc_23">网站和其他平台上的使用规范</a>
</li>
</ul>
</li>
<li>
<a href="#toc_24">参考链接</a>
</li>
</ul>


<hr/>

<h2 id="toc_1">What&#39;s New</h2>

<ul>
<li>2020-03：
<ul>
<li>进一步明确了 Sign in with Apple 按钮在 iOS、macOS、tvOS、watchOS 和 Web 端不同平台上的样式区别；</li>
<li>增加了对创建一个自定义的 Sign in with Apple 按钮（左对齐 logo 样式、只有 logo 样式）的描述。</li>
</ul></li>
</ul>

<hr/>

<h2 id="toc_2">设计帐户注册和登录流程</h2>

<ul>
<li>让用户登录只为了交互有价值的信息：例如，人们可能需要创建一个账户来让 app 可以提供个性化的体验、在 app 中访问额外的功能或者同步数据，如果你的 app 不需要基于账户的功能，那就不需要让用户登录。</li>
<li>在你的所有 app 和网站中考虑使用 Sign in with Apple：为了一个一致性的登录体验，推荐你在你 app 覆盖的所有苹果平台和网站上使用 Sign in with Apple。</li>
<li>登录的请求越往后越好：当用户还没做什么有用的事情就被强制登录时，人们可能会放弃使用 app。在向用户发出请求并让用户提供信息前给用户一个熟悉你 app 的机会。例如，一个流媒体播放 app 在需要登录播放内容前可以先让用户看看 app 提供了什么内容。</li>
<li>在任何可能的时候，直到用户要做出购买决定时再让用户创建账户：如果你的服务支持访客结算系统，在交易完成之后处理好结算过程，并可以给用户一个快速创建账户的机会。</li>
<li>向用户解释清楚登录的好处以及如何注册你的服务：如果你的 app 需要登录账户，那就在登录界面上给用户展示一个清晰友好的说明，描述清楚为什么需要登录以及登录的好处。还有，记住并不是每一个使用你 app 的人在一开始就有一个账户。</li>
<li>注册账户时只收集必要的信息：如果只是为了创建一个独一无二的用户标识符，那就不需要收集用户的名字和电子邮箱信息。</li>
</ul>

<h2 id="toc_3">Sign in with Apple 按钮</h2>

<p>Apple 提供了几种「Sign in with Apple」按钮，你可以使用它们以让用户注册或者登录账户。如果有需要，你可以创建一个自定义的按钮以提供 Sign in with Apple 功能。</p>

<ul>
<li>突出展示「Sign in with Apple」按钮：确保 Sign in with Apple 按钮不比其他的登录按钮小，避免出现滚动才能看到按钮的情况。</li>
</ul>

<h3 id="toc_4">使用系统提供的按钮</h3>

<p>当你使用系统提供的 API 创建一个 Sign in with Apple 按钮时，你可以获得下面这些好处：</p>

<ul>
<li>一个确保使用了 Apple 提供的标题、字体、颜色、样式的按钮；</li>
<li>当你改变按钮样式时，按钮的内容可以保证保持一个理想的比例；</li>
<li>自动翻译按钮上的文字为设备指定的语言；</li>
<li>支持配置按钮的圆角半径以匹配你的 UI 样式（在 iOS、macOS、Web 不同环境下）；</li>
<li>一个系统提供的替代文本标签，可以让「旁白/VoiceOver」描述出按钮。</li>
</ul>

<p>系统提供了按钮标题的几种变种样式。根据你的内容运行的平台，选择适合你的登录体验的术语样式，并在你的所有界面中一致地使用。<br/>
下面的几种按钮标题在 iOS、macOS、tvOS 中都可用，「Sign in with Apple」和「Continue with Apple」在 Web 端中可用：</p>

<p><img src="media/15676959360699/26579F8A-7287-4AC8-92D5-71FDE19454C8.png" alt="26579F8A-7287-4AC8-92D5-71FDE19454"/></p>

<p>对于 watchOS，系统提供了一种按钮标题： Sign in</p>

<p><img src="media/15676959360699/apple-id-watch-44mm-no-background.png" alt="apple-id-watch-44mm-no-background"/></p>

<p>取决于不同的平台，系统最多提供三种 Sign in with Apple 按钮的外观样式：白色（White）、带描边的白色（White with Outline Rule）、黑色（Black）。根据你要展示按钮处的 UI 背景选择最适合的外观。</p>

<h4 id="toc_5">白色</h4>

<p>白色外观样式在所有平台和 Web 端可用。在可以提供足够对比度的深色或者彩色背景上使用白色外观样式。</p>

<p><img src="media/15676959360699/EDA18A96-D998-47A8-9813-3B599C3F32E5.png" alt="EDA18A96-D998-47A8-9813-3B599C3F32E5"/></p>

<h4 id="toc_6">带描边的白色</h4>

<p>带描边的白色外观样式在 iOS、macOS 和 Web 端可用。在白色或者不能与白色按钮填充形成足够对比度的浅色背景上使用带描边的白色外观样式。不要在深色或者太饱和颜色的背景上使用，因为黑色描边会让视觉上变杂乱，可以使用白色外观样式与深色背景形成对比。</p>

<p><img src="media/15676959360699/9C16E913-90B5-40C0-8890-C91679BE5341.png" alt="9C16E913-90B5-40C0-8890-C91679BE5341"/></p>

<h4 id="toc_7">黑色</h4>

<p>黑色外观样式在所有平台和 Web 端上可用。在白色或者可以提供足够对比度的浅色背景上使用黑色外观样式。不要在黑色或者深色的背景上使用。</p>

<p><img src="media/15676959360699/11230F79-4793-4365-8A05-34C9CE13E0E9.png" alt="11230F79-4793-4365-8A05-34C9CE13E0E9"/></p>

<p>与其他平台上的黑色 Sign in with Apple 按钮不同的是，watchOS 平台上的按钮使用的填充颜色并不是完全的黑色。为了与 Apple Watch 的纯黑色背景形成对比，watchOS 的按钮使用了系统定义的深灰色外观样式。</p>

<p><img src="media/15676959360699/apple-id-watch-44mm.png" alt="apple-id-watch-44mm"/></p>

<h3 id="toc_8">按钮尺寸和位置</h3>

<ul>
<li>调整圆角半径以与 app 中的其他登录按钮样式相匹配：默认情况下，Sign in with Apple 有一个圆角半径。在 iOS、macOS 和 Web 端，你可通过改变这个半径值让按钮变成圆角矩形或者药丸形状。</li>
</ul>

<p><img src="media/15676959360699/FC92B3C7-DF00-48A7-8945-22ADEBFD921E.png" alt="FC92B3C7-DF00-48A7-8945-22ADEBFD921E"/></p>

<ul>
<li>在 iOS、macOS 和 Web 端，保证最小按钮尺寸和按钮周围的边距：取决于不同的地区，按钮的标题长度可能会发生变化。使用下面推荐的指导值。</li>
</ul>

<p><img src="media/15676959360699/0E89E6BB-771B-4BA0-8E9D-87E545211E43.png" alt="0E89E6BB-771B-4BA0-8E9D-87E545211E43"/></p>

<h3 id="toc_9">创建一个自定义的 Sign in with Apple 按钮</h3>

<p>如果你的布局需要，你可以为 iOS、macOS 或者 Web 端创建一个自定义的 Sign in with Apple 按钮。例如，如果你支持多种登录方法，你可能需要展示一些使用了左对齐 logo 的按钮或者只展示一个 logo 的按钮。</p>

<p><img src="media/15676959360699/6B307781-A9ED-4DF6-801F-D77EFDA9C02C.png" alt="6B307781-A9ED-4DF6-801F-D77EFDA9C02C"/></p>

<p><a href="https://developer.apple.com/design/resources/">Apple 的设计资源</a>提供了可下载的 Apple logo 资源文件，你可以使用它们创建自定义的左对齐 logo 的 Sign in with Apple 按钮或者只展示一个 logo 的 Sign in with Apple 按钮。Logo 文件包含 PNG、SVG 和 PDF 格式，对于两种类型的按钮资源文件都提供了两种外观样式。下面是黑色和白色的只展示一个 logo 的按钮资源文件示例，为了保持可见，每一个都添加了一个背景：</p>

<p><img src="media/15676959360699/6B595169-B650-49A7-B1E5-101E1B7E4DEA.png" alt="6B595169-B650-49A7-B1E5-101E1B7E4DEA"/></p>

<p>所以可下载的 logo 文件都包括了为了在按钮容易放置 logo 的边界间距：</p>

<ul>
<li>左对齐 logo 资源文件包括了竖直边界间距，以确保 logo 和 按钮之间有正确的比例；水平边界间距，以在 logo 和按钮的左边界以及标题间提供一个最小边界。</li>
<li>只有 logo 的资源文件包括了竖直和水平边界间距，以确保 logo 和按钮之间有正确的比例。</li>
</ul>

<p>只使用从  <a href="https://developer.apple.com/design/resources/">Apple 设计资源</a>下载的 logo 资源文件。遵循下面的指导准则创建和放置可下载的 logo 资源文件：</p>

<ul>
<li>不要使用 Apple logo 本身作为一个按钮；</li>
<li>logo 资源文件的高度要和按钮的高度相匹配；</li>
<li>不要切割 logo 资源文件；</li>
<li>不要增加竖直边界间距；</li>
<li>不要在 logo 资源文件中使用自定义的颜色。</li>
</ul>

<h4 id="toc_10">左对齐 logo 样式的按钮</h4>

<ul>
<li>基于按钮的高度选择 logo 资源文件的格式：因为 SVG 和 PDF 是矢量图形格式，你可以使用这些文件创建任何高度的按钮。只在按钮高度是 44pt（iOS 中默认和推荐的按钮高度） 时使用 PNG 格式。左对齐 logo 资源文件包含小、中、大不同尺寸，你可以根据你展示的所有注册按钮匹配不同的 logo 尺寸。</li>
<li>对于按钮标题（ Sign in with Apple、Sign up with Apple、Continue with Apple）使用系统字体：为了看上去正确无误，你自定义按钮的标题和按钮高度应该和系统提供的按钮使用相同的比例。特别的，标题的字体尺寸应该是按钮高度的 43%，换句话说，按钮的高度应该是标题字体尺寸的 233%，取最接近的整数。下面是两个例子：</li>
</ul>

<p><img src="media/15676959360699/8ECC8351-DAA5-43E9-879C-F545FD53F50A.png" alt="8ECC8351-DAA5-43E9-879C-F545FD53F50A"/></p>

<ul>
<li>保持按钮标题的大小写样式不变：按钮标题的所有样式第一个单词（即 <em>Sign</em> 和 <em>Continue</em>）和 <em>Apple</em> 要大写，其他字母要小写。不要改变这种样式，如在标题中把每一个字母都大写。</li>
<li>让标题和 logo 在按钮内保持垂直对齐：为了做到这样，让标题和按钮的中间保持垂直对齐，然后添加 logo 图片，确保它的高度与按钮高度相匹配。因为 logo 图片包括顶部和底部的边界间距，在按钮中垂直对齐标题可确保标题、logo 和按钮保持正确对齐。</li>
<li>如有必要，插入 logo：如果你需要让 Apple logo 与其他 logo 水平对齐，你可以在 logo 的左边插入。</li>
<li>在按钮标题和按钮的右侧边界间保持一个最小的边界值：边界值最小应该为按钮宽度的 8%。</li>
<li>保持最小按钮尺寸和按钮四周的边界值：取决于不同的地区，按钮的标题长度可能会发生变化。使用下面推荐的指导值。</li>
</ul>

<p><img src="media/15676959360699/0E89E6BB-771B-4BA0-8E9D-87E545211E43.png" alt="0E89E6BB-771B-4BA0-8E9D-87E545211E43"/></p>

<h4 id="toc_11">只有 logo 样式的按钮</h4>

<ul>
<li>基于按钮的尺寸选择 logo 资源文件的格式：像左对齐 logo 样式的按钮的资源文件一样，只有 logo 样式的按钮的可下载的资源文件也有 SVG、PDF、PNG 三种格式。对于任何尺寸的按钮，使用基于矢量的 SVG 和 PDF 格式；对于 44pt × 44pt 大小的按钮，使用 PNG 格式。</li>
<li>不要在只有 logo 的图片中增加水平边界间距：只要 logo 样式的 Sign in with Apple 按钮总是 1:1 比例，资源文件已经在四周包括了正确的边界间距。</li>
<li>使用一个遮罩去改变默认的只有 logo 的图片的矩形形状：例如，你可能想要使用一个圆形或者圆角矩形去展示所有的只有 logo 样式的登录按钮。不要为了减少内建的边界间距切割 Apple 提供的资源文件或者只使用 logo 本身，避免包括额外的边界间距。</li>
</ul>

<p><img src="media/15676959360699/7E1F8395-EE6D-424F-838A-1D37E8FE413C.png" alt="7E1F8395-EE6D-424F-838A-1D37E8FE413C"/></p>

<ul>
<li>在按钮四周保持一个最小边界值：边界值最小应该为按钮高度的 1/10。</li>
</ul>

<h2 id="toc_12">实现 Sign in with Apple</h2>

<h3 id="toc_13">纵览</h3>

<p>当用户点击 Sign in with Apple 按钮后，用户会看到一个根据你 app 要求提供的信息而填好了信息的表单显示在屏幕上，像是名字和电子邮箱。用户可以在提供原始电子邮箱或者一个新的由 Apple 提供的邮箱之间做出选择。当用户点击继续按钮后，就完成了登录。你的 app 也会获得一个独一无二、固定 ID、用户的名字以及一个可以让用户收到邮件的电子邮件地址，不再需要用户做收取验证邮件、点击验证链接这样的事。</p>

<p><img src="media/15676959360699/6295E671-AC96-4AC1-A3E1-FB19680E2845.png" alt=""/></p>

<p>当用户在一台新的设备上登录时，一个轻轻的点击就可以登录之前的用户并开始使用你的 app。</p>

<p><img src="media/15676959360699/CEF1061B-D667-459E-9C01-92E1A7AFF629.png" alt=""/></p>

<p>Sign in with Apple 为你的 app 提供了一套流线化的账户设置体验，不需要填写复杂的表格，只需要轻轻一点。用户从 App Store 使用他的 Apple ID 下载了 app，在 app 中也顺其自然地通过 Sign in with Apple 完成登录。开发者也获得了一个已验证并且可以让用户收到邮件的邮箱，即使用户隐藏了自己的真实邮箱，提供的新的邮箱收取的邮件也可以通过 Apple 的转发服务转到用户的真实邮箱，同样用户也可以使用这个新的邮箱进行邮件回复。</p>

<p><img src="media/15676959360699/FFFF6FC2-C3E9-4BCF-87D4-72D2B0037494.png" alt=""/></p>

<p>Apple 也可以在使用 Sign in with Apple 登录时，通过机器学习和其他获取的信息告诉开发者这个用户是真实的还是未知的。如果是真实的，你就不需要再判断，尽管给这个用户良好的使用体验，如果是未知的，那可能是一个真人用户，也可能是一个机器人。</p>

<p><img src="media/15676959360699/41E3B437-F2CF-4AD7-AB44-C8ADB1A1CD7E.png" alt=""/></p>

<p>Sign in with Apple 也是跨平台的，不仅可以在所有苹果平台上使用，也可以通过 JS API 在网站、Windows、Android 上使用。</p>

<p><img src="media/15676959360699/AC333E4F-9AEB-4AFE-A3BB-FBBB376EC0D9.png" alt=""/></p>

<h3 id="toc_14">让 Sign in with Apple 与你的 app 结合</h3>

<p>分成下图的四个部分：按钮、授权、鉴权、处理变动。先展示 Sign in with Apple 按钮，接着配置和执行授权的请求，在用户看到 Sign in with Apple 按钮并通过 Face ID/Touch ID 完成确认后，授权的结果会返回给 app。这时你需要与 Apple ID 服务器确认结果并在你的 app 中创建一个新用户。最后，凭据状态可能会发生变化，你的 app 需要处理处理好这些变化状态。</p>

<p><img src="media/15676959360699/28AD43B3-2C45-47AA-BCB9-5D98DE69EC5C.png" alt=""/></p>

<h4 id="toc_15">Button 按钮</h4>

<p>只需要几行代码，你就可以把 <code>AuthorizationAppleIDButton</code>  添加到你的 app 中。具体代码如下：</p>

<pre class="line-numbers"><code class="language-swift">// Add “Sign in with Apple” button to your login view

func setUpProviderLoginView() {
 let button = ASAuthorizationAppleIDButton()
 button.addTarget(self, action: #selector(handleAuthorizationAppleIDButtonPress),for: .touchUpInside)
 self.loginProviderStackView.addArrangedSubview(button)
}
</code></pre>

<h4 id="toc_16">Authorization 授权</h4>

<p>利用几行代码，你就可以初始化一个 Apple ID 授权请求。具体的代码如下：</p>

<pre class="line-numbers"><code class="language-swift">// Configure request, setup delegates and perform authorization request

@objc func handleAuthorizationButtonPress() {
 let request = ASAuthorizationAppleIDProvider().createRequest()
 request.requestedScopes = [.fullName, .email]

 let controller = ASAuthorizationController(authorizationRequests: [request])

 controller.delegate = self
 controller.presentationContextProvider = self

 controller.performRequests()
}
</code></pre>

<h4 id="toc_17">Verification 鉴权</h4>

<p>在授权后，app 如果鉴权成功会从凭据中获得一系列信息，如果用户中断了过程或者发生了错误需要有错误处理的逻辑。具体的代码如下：</p>

<pre class="line-numbers"><code class="language-swift">func authorizationController(controller _: ASAuthorizationController, didCompleteWithAuthorization authorization: ASAuthorization) {
 if let credential = authorization.credential as? ASAuthorizationAppleIDCredential {
 let userIdentifier = credential.user
 let identityToken = credential.identityToken
 let authCode = credential.authorizationCode
 let realUserStatus = credential.realUserStatus

 // Create account in your system
 }
}

func authorizationController(_: ASAuthorizationController, didCompleteWithError error: Error) {
 // Handle error
} 
</code></pre>

<p>对于凭据中的信息，userID 是一个独一无二、稳定的、团队范围内的用户识别符，你可以在不同的平台中使用它获取用户信息，它是与你的开发者账户绑定的。鉴权数据包括身份 token 和授权 code，token 的生命周期很短，可以与 Apple ID 服务器交换新的 token。可选的，系统还会返回你请求的账户信息，比如名字和电子邮箱。最后是一个之前提到的真实用户指示标志。</p>

<p><img src="media/15676959360699/59379B20-8BF4-4099-9581-36EC3EBA55F2.png" alt=""/></p>

<h4 id="toc_18">Handling Changes 处理变动</h4>

<p>你的用户可能会在你的 app 中停止使用 Apple ID 登录，可能会在设备中登出。授权服务框架提供了一个快速 API 供开发者获取相关状态。具体的代码如下：</p>

<pre class="line-numbers"><code class="language-swift">let provider = ASAuthorizationAppleIDProvider()
provider.getCredentialState(forUserID: &quot;currentUserIdentifier&quot;) { (credentialState, error) in
 switch(credentialState){
 case .authorized:
     // Apple ID Credential is valid
 case .revoked:
     // Apple ID Credential revoked, handle unlink
 case .notFound:
     // Credential not found, show login UI
 default: break
 }
}
</code></pre>

<p>NotificationCenter 也可以发出通知，告诉 app 用户的凭据状态已经失效。当失效时，在设备上退出登录，进一步可以引导用户重新登录。具体代码如下：</p>

<pre class="line-numbers"><code class="language-swift">// Register for revocation notification
let center = NotificationCenter.default
let name = NSNotification.Name.ASAuthorizationAppleIDProviderCredentialRevoked
let observer = center.addObserver(forName: name, object: nil, queue: nil) { (Notification) in
 // Sign the user out, optionally guide them to sign in again
}
</code></pre>

<p>用户使用 Sign in with Apple 在你的 app 中注册了用户，他可能还会在其他设备上使用你的 app 或者需要重新登录。当第一次进入 app 时，系统会告诉用户曾经使用 Apple ID 注册了用户，经过 Face ID 检查后就可以完成登录。</p>

<p><img src="media/15676959360699/06CFB432-1493-4EE4-82A7-C290BAE26ED2.png" alt=""/></p>

<p>同时，通过相同的 API，iCloud 钥匙串也可以实现此功能。你需要同时支持这两种登录请求。</p>

<p><img src="media/15676959360699/CD86686F-FB8D-4446-8966-DB9A2DD2309E.png" alt=""/></p>

<p>当用户已存在时，具体的代码如下：</p>

<pre class="line-numbers"><code class="language-swift">///Prompts the user if an existing iCloud Keychain credential or Apple ID credential exists.

func performExistingAccountSetupFlows() {
 // Prepare requests for both Apple ID and password providers.
 let requests = [ASAuthorizationAppleIDProvider().createRequest(),
 ASAuthorizationPasswordProvider().createRequest()]

 // Create an authorization controller with the given requests.
 let authorizationController = ASAuthorizationController(authorizationRequests: requests)
 authorizationController.delegate = self
 authorizationController.presentationContextProvider = self
 authorizationController.performRequests()
 } 
</code></pre>

<p>判断是通过 Apple ID 凭据登录还是 iCloud 钥匙串登录的具体代码如下：</p>

<pre class="line-numbers"><code class="language-swift">func authorizationController(controller _: ASAuthorizationController, didCompleteWithAuthorization authorization: ASAuthorization) {
 switch authorization.credential {
 case let credential as ASAuthorizationAppleIDCredential:
     let userIdentifier = credential.user
     // Sign the user in using the Apple ID credential
case let credential as ASPasswordCredential:
     // Sign the user in using their existing password credential
 default: break
 }
}
</code></pre>

<h3 id="toc_19">跨平台</h3>

<p>在浏览器中，你也可以通过 JS SDK 实现用户熟悉的登录窗口，通过输入 Apple ID 和密码完成登录。其 API 与原生的相似。</p>

<p><img src="media/15676959360699/BE69DE27-DFDC-4CAE-9C9B-792C936B1C0E.png" alt=""/></p>

<p>特别的，在 Safari 浏览器上，点击网页上的 Sign in with Apple 按钮会直接定向到一个原生的像 Apple Pay 一样的表单，用户可以通过 Touch ID 授权快速完成登录。</p>

<p><img src="media/15676959360699/C7FB9A8F-6382-4E42-9DB5-6609B56DF3B3.png" alt=""/></p>

<h3 id="toc_20">Best Practices</h3>

<p><img src="media/15676959360699/751B01C9-1E19-4A80-B841-B9332F298918.png" alt=""/></p>

<h2 id="toc_21">Sign in with Apple 新的审核规范</h2>

<p>2019 年 9 月 12 日 Apple 针对 Sign in with Apple 发出<a href="https://developer.apple.com/news/?id=09122019b">通知</a>，更新了 App Store 审核规范，提供了 app 什么时候该使用 Sign in with Apple 的标准。从现在开始，所有的新 app 必须遵守这个规范，对于已经存在的 app 和 app 更新的最后期限是 2020 年 4 月。对于在 web 上和其他平台上使用，Apple 也提供了相应规范。</p>

<h3 id="toc_22">App Store 审核规范</h3>

<p>对于仅使用了第三方登录或者社交登录服务（例如 Facebook 登录、Google 登录、Twitter 登录、LinkedIn 登录、Amazon 登录、微信登录）设置或者授权用户的主要账户的 app，必须也提供「Sign in with Apple」作为一个同等的选项。用户的主要账户是指他们在 app 中建立的用来识别他们自己、登录、访问某些功能和相关服务的账户。</p>

<p>Sign in with Apple 在下面这些情况中不是必须的：</p>

<ul>
<li>你的 app 只使用了你公司自己的账户设置和登录系统；</li>
<li>你的 app 是一个要求用户使用已有的教育或企业账户登录的教育、企业、商业 app；</li>
<li>你的 app 通过政府或者行业支持的公民身份识别系统或者电子 ID 来授权用户；</li>
<li>你的 app 是特定的第三方服务的客户，用户被要求登录他们的电子邮件、社交媒体或其他第三方账户才能访问他们的内容。</li>
</ul>

<h3 id="toc_23">网站和其他平台上的使用规范</h3>

<p>如果在你的已上架 App Store 的 app 中使用了 Sign in with Apple，我们推荐在任何相关的网站或者其他平台的 app 上通过调用 Apple JS 来提供 Sign in with Apple 功能。</p>

<p>在下面这些情况下，网站或者 app 可能不适合使用 Sign in with Apple：</p>

<ul>
<li>违反任何法律或者是在其他方面不能遵守任何法律要求的；</li>
<li>提供下面的服务或交易的：
<ul>
<li>香烟和烟草产品；</li>
<li>枪、武器或者弹药；</li>
<li>非法药品或者不合法的处方药品；</li>
<li>给用户造成安全风险的项目；</li>
<li>被用于参加非法活动的项目；</li>
<li>色情作品；</li>
<li>假冒或失窃商品。</li>
</ul></li>
<li>主要提供或出售毒品用具或者面向性的用品和服务；</li>
<li>宣扬基于种族、年龄、性别、性别认同、族裔、宗教信仰或性取向的仇恨、暴力或排斥；</li>
<li>参与任何类型的诈骗；</li>
<li>侵犯他人的知识产权、宣传权、隐私权；</li>
<li>以虚假或贬损的方式展示 Apple 和它的产品。</li>
</ul>

<p>除了允许用户自愿地设置一个账户和登录你的 app 或服务，不得通过 Apple API 为了其他目的使用 Sign in with Apple。</p>

<h2 id="toc_24">参考链接</h2>

<ul>
<li><a href="https://developer.apple.com/design/human-interface-guidelines/sign-in-with-apple/overview/">Sign in with Apple - Sign in with Apple - Human Interface Guidelines - Apple Developer</a></li>
<li><a href="https://developer.apple.com/videos/play/wwdc2019/706/">Introducing Sign in with Apple - WWDC 2019 - Videos - Apple Developer</a></li>
<li><a href="https://developer.apple.com/app-store/review/guidelines/#sign-in-with-apple">App Store Review Guidelines - Apple Developer</a></li>
<li><a href="https://developer.apple.com/sign-in-with-apple/usage-guidelines-for-websites-and-other-platforms/">Usage Guidelines for Website and Other Platforms - Sign in with Apple - Apple Developer</a></li>
</ul>

<blockquote>
<p>如果你觉得这篇文章对你有所帮助，欢迎请我喝杯咖啡，感谢你的支持😁</p>

<p><img src="media/14625521742746/15088240400740.jpg" alt=""/></p>
</blockquote>


    

      </div>

      <div class="row">
        <div class="large-6 columns">
        <p class="text-left" style="padding:15px 0px;">
      
          <a href="15681304209417.html" 
          title="Previous Post: 把 iPad 上的 app 带到 Mac 中去（上）">&laquo; 把 iPad 上的 app 带到 Mac 中去（上）</a>
      
        </p>
        </div>
        <div class="large-6 columns">
      <p class="text-right" style="padding:15px 0px;">
      
          <a  href="15707295333245.html" 
          title="Next Post: 设计绝佳的 Siri 捷径 - Siri 捷径从设计到构建（中）">设计绝佳的 Siri 捷径 - Siri 捷径从设计到构建（中） &raquo;</a>
      
      </p>
        </div>
      </div>
      <div class="comments-wrap">
        <div class="share-comments">
          <!-- JiaThis Button BEGIN -->
<div class="jiathis_style_24x24">
	<a class="jiathis_button_tsina"></a>
	<a class="jiathis_button_tqq"></a>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_douban"></a>
	<a class="jiathis_button_qzone"></a>
	<a class="jiathis_button_fb"></a>
	<a class="jiathis_button_twitter"></a>
	<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=" charset="utf-8"></script>
<!-- JiaThis Button END -->

          
            <div id="disqus_thread"></div>
          

          
        </div>
      </div>
    </div><!-- article-wrap -->
  </div><!-- large 8 -->




 <div class="large-4 medium-4 columns">
  <div class="hide-for-small">
    <div id="sidebar" class="sidebar">
          <div id="site-info" class="site-info">
            
                <div class="site-a-logo"><img src="media/14625521742746/Step%20Park%20LOGO-White+Circle-.png" /></div>
            
                <h1>向远公园 | Step Park</h1>
                <div class="site-des">搞懂逻辑 | 理清思路 | 沉淀想法 | 纪录生活</div>
                <div class="social">







<a target="_blank" class="weibo" href="https://weibo.com/chuxiangyuan1104/" title="Weibo">Weibo</a>
<a target="_blank" class="twitter" target="_blank" href="https://twitter.com/chuxiangyuan/" title="Twitter">Twitter</a>
<a target="_blank" class="github" target="_blank" href="https://github.com/ChuXiangyuan/" title="GitHub">GitHub</a>
<a target="_blank" class="email" href="mailto:chuxiangyuan1104@gmail.com" title="Email">Email</a>
  <a target="_blank" class="rss" href="atom.xml" title="RSS">RSS</a>
                
              	 </div>
          	</div>

               
             <div id="site-categories" class="side-item ">
                <div class="side-header">
                  <h2>Featured</h2>
                </div>
                <div class="side-content">
                  
                  <div style="color:#717171; text-align:left; padding:8px;" class="bg-info site_notice">
                    <a style="color:#717171;"  onclick="ga('send','event','global_notice_click');" href="15844652241485.html">1️⃣ 订阅 Apple Music 该选哪个区？</a>

                  </div>
                  

                  <div style="color:#717171; text-align:left; padding:8px;" class="bg-info site_notice">
                    <a style="color:#717171;"  onclick="ga('send','event','global_notice_click');" href="15676959360699.html">2️⃣ Sign in with Apple 的设计准则和功能实现</a>

                  </div>

                  <div style="color:#717171; text-align:left; padding:8px;" class="bg-info site_notice">
                    <a style="color:#717171;"  onclick="ga('send','event','global_notice_click');" href="15706056024784.html">3️⃣ 跨平台设计时的思考路径</a>

                  </div>
                  
                </div>
            </div>
            
    

              <div id="site-categories" class="side-item ">
                <div class="side-header">
                  <h2>Categories</h2>
                </div>
                <div class="side-content">

      	<p class="cat-list">
        
            <a href="Design.html"><strong>Design</strong></a>
        
            <a href="Develop.html"><strong>Develop</strong></a>
        
            <a href="Teconology.html"><strong>Teconology</strong></a>
        
            <a href="Tools.html"><strong>Tools</strong></a>
        
            <a href="Life.html"><strong>Life</strong></a>
        
            <a href="Talk.html"><strong>Talk</strong></a>
        
            <a href="Others.html"><strong>Others</strong></a>
         
        </p>


                </div>
              </div>

              <div id="site-categories" class="side-item">
                <div class="side-header">
                  <h2>Recent Posts</h2>
                </div>
                <div class="side-content">
                <ul class="posts-list">
	      
		      
			      <li class="post">
			        <a href="15942969497015.html">利用好 iPad 的大屏幕 —— 如何为 iPadOS 14 设计 app？</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15904037034817.html">在 App 中提供出色的无障碍使用体验</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15889327298988.html">iPadOS 指针系统的设计规范 iPadOS Pointing System Design Guideline</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15844652241485.html">订阅 Apple Music 该选哪个区？——中美坡港日五大地区全对比</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15904030044639.html">Apple 无障碍功能设计规范</a>
			      </li>
		     
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		   
		  		</ul>
                </div>
              </div>

              

        </div><!-- sidebar -->
      </div><!-- hide for small -->
</div><!-- large 4 -->

</div><!-- row -->

 <div class="page-bottom clearfix">
  <div class="row">
   <p class="copyright">Copyright &copy; 2020
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
</div>

        </section>
      </div>
    </div>


<script type="text/javascript">
    var disqus_shortname = 'chuxiangyuan'; 

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

<script type="text/javascript">
var disqus_shortname = 'chuxiangyuan'; 

(function () {
var s = document.createElement('script'); s.async = true;
s.type = 'text/javascript';
s.src = '//' + disqus_shortname + '.disqus.com/count.js';
(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>
  
    

    <script src="asset/js/foundation.min.js"></script>
    <script>
      $(document).foundation();
      function fixSidebarHeight(){
        var w1 = $('.markdown-body').height();
          var w2 = $('#sidebar').height();
          if (w1 > w2) { $('#sidebar').height(w1); };
      }
      $(function(){
        fixSidebarHeight();
      })
      $(window).load(function(){
          fixSidebarHeight();
      });
     
    </script>

    
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-AMS_SVG-full"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({TeX: { equationNumbers: { autoNumber: "AMS" } }});</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-109532424-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-109532424-1');
  gtag('set', {'user_id': 'USER_ID'}); // 使用已登录的 user_id 来设置用户 ID。
</script>

  </body>
</html>
